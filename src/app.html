<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%sveltekit.assets%/favicon.png" />
    
    <!-- ê¸°ë³¸ ë·°í¬íŠ¸ ì„¤ì • (ëª¨ë°”ì¼ ìµœì í™”) -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    
    <!-- ì œëª© ë° ì„¤ëª… -->
    <title>ê´€ë¦¬ì ì‹œìŠ¤í…œ</title>
    <meta name="description" content="ëª¨ë°”ì¼ ìµœì í™”ëœ ê´€ë¦¬ì ë°±ì˜¤í”¼ìŠ¤ ì‹œìŠ¤í…œ" />
    <meta name="keywords" content="ê´€ë¦¬ì, ë°±ì˜¤í”¼ìŠ¤, PWA, ëª¨ë°”ì¼" />
    <meta name="author" content="Admin System" />
    
    <!-- PWA ë§¤ë‹ˆí˜ìŠ¤íŠ¸ -->
    <link rel="manifest" href="%sveltekit.assets%/manifest.json" />
    
    <!-- PWA í…Œë§ˆ ìƒ‰ìƒ -->
    <meta name="theme-color" content="#1f2937" />
    <meta name="background-color" content="#ffffff" />
    
    <!-- iOS PWA ìµœì í™” -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="ê´€ë¦¬ì" />
    <meta name="apple-touch-fullscreen" content="yes" />
    
    <!-- iOS ì•„ì´ì½˜ ì„¤ì • -->
    <link rel="apple-touch-icon" href="%sveltekit.assets%/icon-192x192.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="%sveltekit.assets%/icon-192x192.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="%sveltekit.assets%/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="%sveltekit.assets%/icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="%sveltekit.assets%/icon-128x128.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="%sveltekit.assets%/icon-128x128.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="%sveltekit.assets%/icon-96x96.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="%sveltekit.assets%/icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="%sveltekit.assets%/icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="%sveltekit.assets%/icon-72x72.png" />
    
    <!-- Android PWA ì„¤ì • -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="ê´€ë¦¬ì ì‹œìŠ¤í…œ" />
    
    <!-- Windows íƒ€ì¼ ì„¤ì • -->
    <meta name="msapplication-TileColor" content="#1f2937" />
    <meta name="msapplication-TileImage" content="%sveltekit.assets%/icon-144x144.png" />

    
    <!-- ë³´ì•ˆ í—¤ë” -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- CSP ì •ì±… ìˆ˜ì • - localhost:8443 í—ˆìš© -->
    <!--
    <meta http-equiv="Content-Security-Policy" 
          content="
            default-src 'self';
            script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://cdnjs.cloudflare.com https://www.gstatic.com blob:;
            worker-src 'self' blob: data:;
            style-src 'self' 'unsafe-inline' https://unpkg.com https://cdnjs.cloudflare.com;
            img-src 'self' data: blob: https: http:;
            font-src 'self' 'unsafe-inline' data: https://unpkg.com https://cdnjs.cloudflare.com;
            connect-src 'self' 
                      https://localhost:8443 
                      wss://localhost:8443 
                      https://*.local:8443
                      https://*:8443
                      wss://*:8443
                      https://unpkg.com 
                      https://cdnjs.cloudflare.com
                      https://firebaseinstallations.googleapis.com
                      https://fcmregistrations.googleapis.com
                      https://fcm.googleapis.com
                      https://firebase.googleapis.com;
            frame-src 'self';
            object-src 'none';
            base-uri 'self';
            form-action 'self';
          ">
    -->
    <!-- ìºì‹œ ì œì–´ -->
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0" />
    <meta http-equiv="Pragma" content="no-cache" />
    
    <!-- ì¶”ê°€ ë©”íƒ€ íƒœê·¸ -->
    <meta name="format-detection" content="telephone=no" />
    <meta name="robots" content="noindex, nofollow" />
    
    <!-- í”„ë¦¬ë¡œë“œ ì„¤ì • -->
    <link rel="preconnect" href="/" />

    <!-- JsBarcode ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œì»¬ ë¡œë“œ -->
	  <script src="/jsbarcode.min.js"></script>

    <!-- FilePond í”„ë¦¬ë¡œë“œ ì¶”ê°€ -->
    <link rel="stylesheet" href="/filepond.css">
    <link rel="stylesheet" href="/filepond-plugin-image-preview.css">
    <script src="/filepond.min.js"></script>
    <script src="/filepond-plugin-file-validate-type.min.js"></script>
    <script src="/filepond-plugin-file-validate-size.min.js"></script>
    <script src="/filepond-plugin-image-preview.min.js"></script>
    <script src="/filepond-plugin-image-resize.min.js"></script>
    <script src="/filepond-plugin-image-transform.min.js"></script>

    <script>
      if (window.FilePond) {
        const plugins = [];
        if (window.FilePondPluginFileValidateType) plugins.push(window.FilePondPluginFileValidateType);
        if (window.FilePondPluginFileValidateSize) plugins.push(window.FilePondPluginFileValidateSize);
        if (window.FilePondPluginImagePreview) plugins.push(window.FilePondPluginImagePreview);
        if (window.FilePondPluginImageResize) plugins.push(window.FilePondPluginImageResize);
        if (window.FilePondPluginImageTransform) plugins.push(window.FilePondPluginImageTransform);
        
        if (plugins.length > 0) {
          window.FilePond.registerPlugin(...plugins);
        }
        window.filePondReady = true;
      }
    </script>

    %sveltekit.head%
  </head>
  
  <body data-sveltekit-preload-data="tap" data-sveltekit-preload-code="tap" class="loading">
    <!-- ë¡œë”© í™”ë©´ -->
    <div id="app-loading" style="
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      color: white;
      font-family: system-ui, -apple-system, sans-serif;
      transition: opacity 0.3s ease-out;
    ">
      <div style="
        width: 60px;
        height: 60px;
        border: 4px solid rgba(255,255,255,0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
        margin-bottom: 20px;
      "></div>
      <h2 style="margin: 0; font-size: 1.5rem; font-weight: 300;">ê´€ë¦¬ì ì‹œìŠ¤í…œ</h2>
      <p style="margin: 10px 0 0 0; opacity: 0.8; font-size: 0.9rem;">ë¡œë”© ì¤‘...</p>
    </div>
    
    <!-- SvelteKit ì•± ì»¨í…Œì´ë„ˆ -->
    <div style="display: contents">%sveltekit.body%</div>
    
    <!-- PWA ì„¤ì¹˜ ë²„íŠ¼ (ìˆ¨ê¹€ ìƒíƒœ) -->
    <button id="pwa-install-btn" style="
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 25px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: none;
      z-index: 1000;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    " onclick="installPWA()">
      ğŸ“± ì•± ì„¤ì¹˜
    </button>
    
    <!-- ìŠ¤íƒ€ì¼ ë° ìŠ¤í¬ë¦½íŠ¸ -->
    <style>
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      
      @keyframes slideInUp {
        from {
          transform: translateY(100%);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      
      .loading {
        overflow: hidden;
      }
      
      #pwa-install-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0,0,0,0.2);
      }
      
      /* ëª¨ë°”ì¼ Safe Area ì§€ì› */
      @supports (padding: max(0px)) {
        body {
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
        }
        
        #pwa-install-btn {
          bottom: max(20px, env(safe-area-inset-bottom) + 10px);
          right: max(20px, env(safe-area-inset-right) + 10px);
        }
      }
    </style>
    
    <script>
      // ì „ì—­ ë³€ìˆ˜
      let deferredPrompt;
      
      // ë¡œë”© í™”ë©´ ì œê±°
      function hideLoadingScreen() {
        const loading = document.getElementById('app-loading');
        if (loading) {
          setTimeout(() => {
            loading.style.opacity = '0';
            setTimeout(() => {
              loading.remove();
              document.body.classList.remove('loading');
            }, 300);
          }, 500);
        }
      }
      
      // DOM ë¡œë“œ ì™„ë£Œ ì‹œ ë¡œë”© í™”ë©´ ì œê±°
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', hideLoadingScreen);
      } else {
        hideLoadingScreen();
      }
      
      // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì²˜ë¦¬
      window.addEventListener('beforeinstallprompt', (e) => {
        console.log('ğŸ“± PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì¤€ë¹„ë¨');
        e.preventDefault();
        deferredPrompt = e;
        showInstallButton();
      });
      
      // ì•± ì„¤ì¹˜ë¨ ì´ë²¤íŠ¸
      window.addEventListener('appinstalled', () => {
        console.log('ğŸ‰ PWA ì„¤ì¹˜ ì™„ë£Œ');
        hideInstallButton();
        deferredPrompt = null;
        
        // ì„¤ì¹˜ ì„±ê³µ í† ìŠ¤íŠ¸
        showToast('ì•±ì´ ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
      });
      
      // PWA ì„¤ì¹˜ ë²„íŠ¼ í‘œì‹œ
      function showInstallButton() {
        const btn = document.getElementById('pwa-install-btn');
        if (btn) {
          btn.style.display = 'block';
        }
      }
      
      // PWA ì„¤ì¹˜ ë²„íŠ¼ ìˆ¨ê¹€
      function hideInstallButton() {
        const btn = document.getElementById('pwa-install-btn');
        if (btn) {
          btn.style.display = 'none';
        }
      }
      
      // PWA ì„¤ì¹˜ í•¨ìˆ˜
      window.installPWA = async () => {
        if (!deferredPrompt) {
          showToast('ì„¤ì¹˜ê°€ í˜„ì¬ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
          return;
        }
        
        try {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          
          if (outcome === 'accepted') {
            console.log('ğŸ‘ ì‚¬ìš©ìê°€ PWA ì„¤ì¹˜ë¥¼ ìŠ¹ì¸');
          } else {
            console.log('ğŸ‘ ì‚¬ìš©ìê°€ PWA ì„¤ì¹˜ë¥¼ ê±°ë¶€');
          }
          
          deferredPrompt = null;
          hideInstallButton();
        } catch (error) {
          console.error('PWA ì„¤ì¹˜ ì˜¤ë¥˜:', error);
          showToast('ì„¤ì¹˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
        }
      };
      
      // ë²”ìš© í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í•¨ìˆ˜
      function showToast(message, type = 'info', duration = 3000) {
        const toast = document.createElement('div');
        toast.style.cssText = `
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
          color: white;
          padding: 12px 20px;
          border-radius: 8px;
          font-size: 14px;
          z-index: 1002;
          animation: slideInUp 0.3s ease-out;
          max-width: 90%;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        `;
        toast.textContent = message;
        
        document.body.appendChild(toast);
        
        setTimeout(() => {
          toast.style.opacity = '0';
          toast.style.transform = 'translateX(-50%) translateY(100%)';
          setTimeout(() => {
            if (toast.parentNode) {
              toast.parentNode.removeChild(toast);
            }
          }, 300);
        }, duration);
      }
      
      // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
      window.showToast = showToast;
      
      // ì•± ê°€ì‹œì„± ë³€ê²½ ì‹œ ì²˜ë¦¬ (ë°±ê·¸ë¼ìš´ë“œì—ì„œ ëŒì•„ì˜¬ ë•Œ)
      document.addEventListener('visibilitychange', () => {
        if (!document.hidden) {
          console.log('ğŸ“± ì•±ì´ í¬ê·¸ë¼ìš´ë“œë¡œ ëŒì•„ì˜´');
          // í•„ìš”ì‹œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ë“± ì²˜ë¦¬
        }
      });
      
      // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ê°ì§€
      window.addEventListener('online', () => {
        showToast('ì¸í„°ë„· ì—°ê²°ì´ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
      });
      
      window.addEventListener('offline', () => {
        showToast('ì¸í„°ë„· ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤.', 'error');
      });
      
      // ê°œë°œ í™˜ê²½ì—ì„œ ì½˜ì†” ë¡œê·¸
      if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
        console.log('ğŸš€ SvelteKit + PWA ê´€ë¦¬ì ì‹œìŠ¤í…œ');
        console.log('ğŸ“± PWA ê¸°ëŠ¥:', 'serviceWorker' in navigator ? 'ì§€ì›ë¨' : 'ì§€ì›ì•ˆë¨');
        console.log('ğŸŒ ì˜¨ë¼ì¸ ìƒíƒœ:', navigator.onLine ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸');
      }
    </script>
  </body>
</html>